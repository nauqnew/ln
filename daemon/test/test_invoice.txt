wen@ubuntu:~$ cd lightning/
wen@ubuntu:~/lightning$ cd `git rev-parse --show-toplevel`/daemon/test
wen@ubuntu:~/lightning/daemon/test$ . scripts/vars.sh
wen@ubuntu:~/lightning/daemon/test$ . scripts/helpers.sh
wen@ubuntu:~/lightning/daemon/test$ parse_cmdline 2 "$@" --verbose
wen@ubuntu:~/lightning/daemon/test$ setup_lightning 2
wen@ubuntu:~/lightning/daemon/test$ start_lightningd 2
		{ "type" : "INFO", "time" : "0.140557949", "source" : "lightningd(23323):", "log" : "Hello world!" }, 
		{ "type" : "INFO", "time" : "0.143283781", "source" : "lightningd(23328):", "log" : "Hello world!" }, 
[
  "4f206c15380bbcd086b2246d8a80dfb7b126954d1a5ddc120c8101108f100306"
]
wen@ubuntu:~/lightning/daemon/test$ lcli1 connect localhost $PORT2 $FUND_INPUT_TX &
[1] 23422
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 connect localhost 4001 0100000001bf815ad833c952a9874a8e00e9ea49ff0ed3ce037589cf242360d059a908527c000000006b483045022100f160ef01b023a6f742bf3abaffc54ca952cecaefc8723345e421b87c9d26e193022038669e723aa42bda973ab28a0c4bee303af7c262e5754130524661c19ff1e3a90121029ce5783d44873811bd920bc60738a7b0cf8192a277ce7a117232ccb7d42f0685feffffff0240420f000000000017a9141bd46b67413fce29ddbbeedbf188498f78551d71879488254a000000001976a914e5a0179ecf9bdfceb4f066662716b57004221ed288ace2010000
wen@ubuntu:~/lightning/daemon/test$ check_tx_spend
  "63fbd3d081aa3983cdf74a83d2e4307339b20add8e7b0b551b0d685310028bc2"
wen@ubuntu:~/lightning/daemon/test$ $CLI generate 1
[
  "741e8bfcf97a1fcac32313414ecf5f1831f17e094e1cd687e47b23009db49b35"
]
wen@ubuntu:~/lightning/daemon/test$ { "id" : "03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8" }

[1]+  Done                    lcli1 connect localhost $PORT2 $FUND_INPUT_TX
wen@ubuntu:~/lightning/daemon/test$ $CLI getblockchaininfo
{
  "chain": "regtest",
  "blocks": 484,
  "headers": 484,
  "bestblockhash": "741e8bfcf97a1fcac32313414ecf5f1831f17e094e1cd687e47b23009db49b35",
  "difficulty": 4.656542373906925e-10,
  "mediantime": 1481797196,
  "verificationprogress": 1,
  "chainwork": "00000000000000000000000000000000000000000000000000000000000003ca",
  "pruned": false,
  "softforks": [
    {
      "id": "bip34",
      "version": 2,
      "enforce": {
        "status": false,
        "found": 484,
        "required": 750,
        "window": 1000
      },
      "reject": {
        "status": false,
        "found": 484,
        "required": 950,
        "window": 1000
      }
    }, 
    {
      "id": "bip66",
      "version": 3,
      "enforce": {
        "status": false,
        "found": 484,
        "required": 750,
        "window": 1000
      },
      "reject": {
        "status": false,
        "found": 484,
        "required": 950,
        "window": 1000
      }
    }, 
    {
      "id": "bip65",
      "version": 4,
      "enforce": {
        "status": false,
        "found": 484,
        "required": 750,
        "window": 1000
      },
      "reject": {
        "status": false,
        "found": 484,
        "required": 950,
        "window": 1000
      }
    }
  ],
  "bip9_softforks": {
    "csv": {
      "status": "active",
      "startTime": 0,
      "timeout": 999999999999
    },
    "segwit": {
      "status": "active",
      "startTime": 0,
      "timeout": 999999999999
    }
  }
}
wen@ubuntu:~/lightning/daemon/test$ DO_RECONNECT=$RECONNECT
wen@ubuntu:~/lightning/daemon/test$ DO_RECONNECT=$RECONNECT
wen@ubuntu:~/lightning/daemon/test$ $CLI getrawtransaction 63fbd3d081aa3983cdf74a83d2e4307339b20add8e7b0b551b0d685310028bc2 1
{
  "hex": "0200000000010153faf3ab4e5fb31c680be76ef6dd9d2454c3dfbb987280fcc9de6010c48e8f6f00000000171600148e26c73692f1cccbc6678023efccd0ee849ae934ffffffff0188220f0000000000220020c7820cab47f3c7e054a212e997ab18661557adca443226959f6fef8fd776057102483045022100bf290274699e5bb7b098bda97fd35e15768ea79874bd6a76a22c7bcb1a258f9702203dbf5897126e49a3494ced3b2487724c558cada0eb69ecd8b874c238060397d8012103673d1d648371a33432329858856c64909e97fe641ee200deaea3e4a6e5c8533b00000000",
  "txid": "63fbd3d081aa3983cdf74a83d2e4307339b20add8e7b0b551b0d685310028bc2",
  "hash": "968397e1aa06b5f4aee7771e68b7f9cb65a486bd284b72874b2f0422b729cb5d",
  "size": 227,
  "vsize": 145,
  "version": 2,
  "locktime": 0,
  "vin": [
    {
      "txid": "6f8f8ec41060dec9fc807298bbdfc354249dddf66ee70b681cb35f4eabf3fa53",
      "vout": 0,
      "scriptSig": {
        "asm": "00148e26c73692f1cccbc6678023efccd0ee849ae934",
        "hex": "1600148e26c73692f1cccbc6678023efccd0ee849ae934"
      },
      "txinwitness": [
        "3045022100bf290274699e5bb7b098bda97fd35e15768ea79874bd6a76a22c7bcb1a258f9702203dbf5897126e49a3494ced3b2487724c558cada0eb69ecd8b874c238060397d801", 
        "03673d1d648371a33432329858856c64909e97fe641ee200deaea3e4a6e5c8533b"
      ],
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.00991880,
      "n": 0,
      "scriptPubKey": {
        "asm": "0 c7820cab47f3c7e054a212e997ab18661557adca443226959f6fef8fd7760571",
        "hex": "0020c7820cab47f3c7e054a212e997ab18661557adca443226959f6fef8fd7760571",
        "type": "witness_v0_scripthash"
      }
    }
  ],
  "blockhash": "741e8bfcf97a1fcac32313414ecf5f1831f17e094e1cd687e47b23009db49b35",
  "confirmations": 1,
  "time": 1481856207,
  "blocktime": 1481856207
}
wen@ubuntu:~/lightning/daemon/test$ $CLI getrawtransaction 6f8f8ec41060dec9fc807298bbdfc354249dddf66ee70b681cb35f4eabf3fa53 1
{
  "hex": "0100000001bf815ad833c952a9874a8e00e9ea49ff0ed3ce037589cf242360d059a908527c000000006b483045022100f160ef01b023a6f742bf3abaffc54ca952cecaefc8723345e421b87c9d26e193022038669e723aa42bda973ab28a0c4bee303af7c262e5754130524661c19ff1e3a90121029ce5783d44873811bd920bc60738a7b0cf8192a277ce7a117232ccb7d42f0685feffffff0240420f000000000017a9141bd46b67413fce29ddbbeedbf188498f78551d71879488254a000000001976a914e5a0179ecf9bdfceb4f066662716b57004221ed288ace2010000",
  "txid": "6f8f8ec41060dec9fc807298bbdfc354249dddf66ee70b681cb35f4eabf3fa53",
  "hash": "6f8f8ec41060dec9fc807298bbdfc354249dddf66ee70b681cb35f4eabf3fa53",
  "size": 224,
  "vsize": 224,
  "version": 1,
  "locktime": 482,
  "vin": [
    {
      "txid": "7c5208a959d0602324cf897503ced30eff49eae9008e4a87a952c933d85a81bf",
      "vout": 0,
      "scriptSig": {
        "asm": "3045022100f160ef01b023a6f742bf3abaffc54ca952cecaefc8723345e421b87c9d26e193022038669e723aa42bda973ab28a0c4bee303af7c262e5754130524661c19ff1e3a9[ALL] 029ce5783d44873811bd920bc60738a7b0cf8192a277ce7a117232ccb7d42f0685",
        "hex": "483045022100f160ef01b023a6f742bf3abaffc54ca952cecaefc8723345e421b87c9d26e193022038669e723aa42bda973ab28a0c4bee303af7c262e5754130524661c19ff1e3a90121029ce5783d44873811bd920bc60738a7b0cf8192a277ce7a117232ccb7d42f0685"
      },
      "sequence": 4294967294
    }
  ],
  "vout": [
    {
      "value": 0.01000000,
      "n": 0,
      "scriptPubKey": {
        "asm": "OP_HASH160 1bd46b67413fce29ddbbeedbf188498f78551d71 OP_EQUAL",
        "hex": "a9141bd46b67413fce29ddbbeedbf188498f78551d7187",
        "reqSigs": 1,
        "type": "scripthash",
        "addresses": [
          "2MunNhdcVXiLwCPeejmif9nTnHd5cbHd4NN"
        ]
      }
    }, 
    {
      "value": 12.43973780,
      "n": 1,
      "scriptPubKey": {
        "asm": "OP_DUP OP_HASH160 e5a0179ecf9bdfceb4f066662716b57004221ed2 OP_EQUALVERIFY OP_CHECKSIG",
        "hex": "76a914e5a0179ecf9bdfceb4f066662716b57004221ed288ac",
        "reqSigs": 1,
        "type": "pubkeyhash",
        "addresses": [
          "n2T6pPWXovY499pq2Xu6hZkzszQSLbiDp3"
        ]
      }
    }
  ],
  "blockhash": "4f206c15380bbcd086b2246d8a80dfb7b126954d1a5ddc120c8101108f100306",
  "confirmations": 2,
  "time": 1481856160,
  "blocktime": 1481856160
}
wen@ubuntu:~/lightning/daemon/test$ check_peerstate lcli1 STATE_NORMAL
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 getpeers
		{ "name" : "03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8:", "state" : "STATE_NORMAL", "peerid" : "03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8", "connected" : true, "our_amount" : 924280000, "our_fee" : 67600000, "their_amount" : 0, "their_fee" : 0, "our_htlcs" : 
wen@ubuntu:~/lightning/daemon/test$ check_peerstate lcli2 STATE_NORMAL
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getpeers
		{ "name" : "032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6:", "state" : "STATE_NORMAL", "peerid" : "032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6", "connected" : true, "our_amount" : 0, "our_fee" : 0, "their_amount" : 924280000, "their_fee" : 67600000, "our_htlcs" : 
wen@ubuntu:~/lightning/daemon/test$ A_AMOUNT=$(($AMOUNT - $NO_HTLCS_FEE))
wen@ubuntu:~/lightning/daemon/test$ A_FEE=$NO_HTLCS_FEE
wen@ubuntu:~/lightning/daemon/test$ B_AMOUNT=0
wen@ubuntu:~/lightning/daemon/test$ B_FEE=0
wen@ubuntu:~/lightning/daemon/test$ check_status $A_AMOUNT $A_FEE "" $B_AMOUNT $B_FEE ""
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 getpeers
{ peers : [ { name : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8: , state : STATE_NORMAL , peerid : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8 , connected : true, our_amount : 924280000, our_fee : 67600000, their_amount : 0, their_fee : 0, our_htlcs : [ ], their_htlcs : [ ] } ] } 
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 getpeers
{ peers : [ { name : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8: , state : STATE_NORMAL , peerid : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8 , connected : true, our_amount : 924280000, our_fee : 67600000, their_amount : 0, their_fee : 0, our_htlcs : [ ], their_htlcs : [ ] } ] } 
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getpeers
{ peers : [ { name : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6: , state : STATE_NORMAL , peerid : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6 , connected : true, our_amount : 0, our_fee : 0, their_amount : 924280000, their_fee : 67600000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getpeers
{ peers : [ { name : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6: , state : STATE_NORMAL , peerid : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6 , connected : true, our_amount : 0, our_fee : 0, their_amount : 924280000, their_fee : 67600000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
wen@ubuntu:~/lightning/daemon/test$ HTLC_AMOUNT=100000000
wen@ubuntu:~/lightning/daemon/test$ $CLI getblcokcount
error code: -32601
error message:
Method not found
wen@ubuntu:~/lightning/daemon/test$ EXPIRY=$(( $(blockheight) + 10))
wen@ubuntu:~/lightning/daemon/test$ echo $EXPIRY
494
wen@ubuntu:~/lightning/daemon/test$ RHASH3=`lcli2 invoice $HTLC_AMOUNT RHASH3 | sed 's/.*"\([0-9a-f]*\)".*/\1/'`
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 invoice 100000000 RHASH3
wen@ubuntu:~/lightning/daemon/test$ echo $RHASH3
7c8c6cf3edb38fa1c5c48a1b80b28310a8aaf0cb5286c3a3b2e0ecc0fa0e3439
wen@ubuntu:~/lightning/daemon/test$ lcli2 listinvoice
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 listinvoice
[ 
	{ "label" : "RHASH3", "rhash" : "7c8c6cf3edb38fa1c5c48a1b80b28310a8aaf0cb5286c3a3b2e0ecc0fa0e3439", "msatoshi" : 100000000, "complete" : false } ]
wen@ubuntu:~/lightning/daemon/test$ HTLCID3=`lcli1 dev-newhtlc $ID2 $HTLC_AMOUNT $EXPIRY $RHASH3 | extract_id`
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 dev-newhtlc 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8 100000000 494 7c8c6cf3edb38fa1c5c48a1b80b28310a8aaf0cb5286c3a3b2e0ecc0fa0e3439
wen@ubuntu:~/lightning/daemon/test$ A_AMOUNT=$(($A_AMOUNT - $HTLC_AMOUNT + $NO_HTLCS_FEE / 2))
wen@ubuntu:~/lightning/daemon/test$ B_AMOUNT=$(($B_AMOUNT + $HTLC_AMOUNT - $NO_HTLCS_FEE / 2))
wen@ubuntu:~/lightning/daemon/test$ A_FEE=$(($NO_HTLCS_FEE / 2))
wen@ubuntu:~/lightning/daemon/test$ B_FEE=$(($NO_HTLCS_FEE / 2))
wen@ubuntu:~/lightning/daemon/test$ check_status $A_AMOUNT $A_FEE "" $B_AMOUNT $B_FEE ""
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 getpeers
{ peers : [ { name : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8: , state : STATE_NORMAL , peerid : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8 , connected : true, our_amount : 858080000, our_fee : 33800000, their_amount : 66200000, their_fee : 33800000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 getpeers
{ peers : [ { name : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8: , state : STATE_NORMAL , peerid : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8 , connected : true, our_amount : 858080000, our_fee : 33800000, their_amount : 66200000, their_fee : 33800000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getpeers
{ peers : [ { name : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6: , state : STATE_NORMAL , peerid : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6 , connected : true, our_amount : 66200000, our_fee : 33800000, their_amount : 858080000, their_fee : 33800000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getpeers
{ peers : [ { name : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6: , state : STATE_NORMAL , peerid : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6 , connected : true, our_amount : 66200000, our_fee : 33800000, their_amount : 858080000, their_fee : 33800000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
wen@ubuntu:~/lightning/daemon/test$ echo &RHASH4
[1] 33338

RHASH4: command not found
[1]+  Done                    echo
wen@ubuntu:~/lightning/daemon/test$ RHASH4=`lcli2 invoice $HTLC_AMOUNT RHASH4 | sed 's/.*"\([0-9a-f]*\)".*/\1/'`
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 invoice 100000000 RHASH4
wen@ubuntu:~/lightning/daemon/test$ echo &RHASH4
[1] 33360

RHASH4: command not found
[1]+  Done                    echo
wen@ubuntu:~/lightning/daemon/test$ echo $RHASH4
895166728b40c2408b27ceac39c6cb5e55aee2c23890c749b868aa24087a80f7
wen@ubuntu:~/lightning/daemon/test$ if lcli2 getlog | $FGREP 'Short payment for'; then exit 1; fi
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getlog
wen@ubuntu:~/lightning/daemon/test$ INVOICES=`lcli2 listinvoice | tr -s '\012\011\" ' ' '`
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 listinvoice
wen@ubuntu:~/lightning/daemon/test$ echo $INVOIVES

wen@ubuntu:~/lightning/daemon/test$ echo $INVOICES
[ { label : RHASH3 , rhash : 7c8c6cf3edb38fa1c5c48a1b80b28310a8aaf0cb5286c3a3b2e0ecc0fa0e3439 , msatoshi : 100000000, complete : true }, { label : RHASH4 , rhash : 895166728b40c2408b27ceac39c6cb5e55aee2c23890c749b868aa24087a80f7 , msatoshi : 100000000, complete : false } ]
wen@ubuntu:~/lightning/daemon/test$ HTLCID4=`lcli1 dev-newhtlc $ID2 $(($HTLC_AMOUNT - 1)) $EXPIRY $RHASH4 | extract_id`
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 dev-newhtlc 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8 99999999 494 895166728b40c2408b27ceac39c6cb5e55aee2c23890c749b868aa24087a80f7
wen@ubuntu:~/lightning/daemon/test$ check lcli2 "getlog | $FGREP 'Short payment for'"
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getlog
		{ "type" : "UNUSUAL", "time" : "13159.816237073", "source" : "032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6:", "log" : "Short payment for 'RHASH4' HTLC 1: 99999999 not 100000000 satoshi!" }, 
wen@ubuntu:~/lightning/daemon/test$ check_status $A_AMOUNT $A_FEE "" $B_AMOUNT $B_FEE ""
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 getpeers
{ peers : [ { name : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8: , state : STATE_NORMAL , peerid : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8 , connected : true, our_amount : 858080000, our_fee : 33800000, their_amount : 66200000, their_fee : 33800000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 getpeers
{ peers : [ { name : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8: , state : STATE_NORMAL , peerid : 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8 , connected : true, our_amount : 858080000, our_fee : 33800000, their_amount : 66200000, their_fee : 33800000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getpeers
{ peers : [ { name : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6: , state : STATE_NORMAL , peerid : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6 , connected : true, our_amount : 66200000, our_fee : 33800000, their_amount : 858080000, their_fee : 33800000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getpeers
{ peers : [ { name : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6: , state : STATE_NORMAL , peerid : 032f39733dca1cbd93a03a201e177f58a8a2db67b4d4c8a0915f185bafe1cac3b6 , connected : true, our_amount : 66200000, our_fee : 33800000, their_amount : 858080000, their_fee : 33800000, our_htlcs : [ ], their_htlcs : [ ] } ] } 
wen@ubuntu:~/lightning/daemon/test$ lcli2 delinvoice RHASH4
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 delinvoice RHASH4
{ "label" : "RHASH4", "rhash" : "895166728b40c2408b27ceac39c6cb5e55aee2c23890c749b868aa24087a80f7", "msatoshi" : 100000000 }
wen@ubuntu:~/lightning/daemon/test$ if lcli2 delinvoice RHASH3 >/dev/null; then
>     echo "Should not be able to delete completed invoice!" >&2
>     exit 1
> fi
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 delinvoice RHASH3
wen@ubuntu:~/lightning/daemon/test$ lcli2 delinvoice RHASH3
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 delinvoice RHASH3
"Unknown invoice"
wen@ubuntu:~/lightning/daemon/test$ lcli1 close $ID2
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 close 03613490cf635d6fd34375c759d0f3b78d7126ea2bb7f7286b4664b6da2bf794e8
{  }
wen@ubuntu:~/lightning/daemon/test$ check_tx_spend
  "592453665252169d53ed47912903959d777b45340a6fe10eee98fc00b0b5b019"
wen@ubuntu:~/lightning/daemon/test$ $CLI getrawtransaction 592453665252169d53ed47912903959d777b45340a6fe10eee98fc00b0b5b019 1
{
  "hex": "02000000000101c28b021053680d1b550b7b8edd0ab2397330e4d2834af7cd8339aa81d0d3fb630000000000ffffffff02606c01000000000017a914f8e529b6664082826a37e3dfbf3029c68ea0120b87a8810d000000000017a91466c1fb14bc0f482ed900e7a07bdb78763e00adae87040047304402204117f0fdf9c464849c91416ccf311d86bd6142becf82c8929e0baadbb10bff93022059ed0ec2857dd47388908888ffe3e038322dcb0b85190f154384ba5ac5287df101483045022100cefe4ab55a34747f0d281524b3b756f2018ac7afe1dc8329a46abca64660ace4022040ba1292888c197cba232fc2e43d2a133a42f0db9f82217338086e09fb7c83e2014752210336e6827126689e45525b14c78d333090dc84fd16e5c6cbbc9941bf016863376f2103ab8cf52ccf29b78e5b8401659c461775fb1d82c819ab7d53edec577eb7c1721552ae00000000",
  "txid": "592453665252169d53ed47912903959d777b45340a6fe10eee98fc00b0b5b019",
  "hash": "66455274f8b8f8427d019982f6bfdc1330143c07910bd90461e29c47e90c2dec",
  "size": 336,
  "vsize": 171,
  "version": 2,
  "locktime": 0,
  "vin": [
    {
      "txid": "63fbd3d081aa3983cdf74a83d2e4307339b20add8e7b0b551b0d685310028bc2",
      "vout": 0,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "txinwitness": [
        "", 
        "304402204117f0fdf9c464849c91416ccf311d86bd6142becf82c8929e0baadbb10bff93022059ed0ec2857dd47388908888ffe3e038322dcb0b85190f154384ba5ac5287df101", 
        "3045022100cefe4ab55a34747f0d281524b3b756f2018ac7afe1dc8329a46abca64660ace4022040ba1292888c197cba232fc2e43d2a133a42f0db9f82217338086e09fb7c83e201", 
        "52210336e6827126689e45525b14c78d333090dc84fd16e5c6cbbc9941bf016863376f2103ab8cf52ccf29b78e5b8401659c461775fb1d82c819ab7d53edec577eb7c1721552ae"
      ],
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.00093280,
      "n": 0,
      "scriptPubKey": {
        "asm": "OP_HASH160 f8e529b6664082826a37e3dfbf3029c68ea0120b OP_EQUAL",
        "hex": "a914f8e529b6664082826a37e3dfbf3029c68ea0120b87",
        "reqSigs": 1,
        "type": "scripthash",
        "addresses": [
          "2NFwG6Nt5ZA5SKCxQ1EcDdpykjp8aZY7Ux4"
        ]
      }
    }, 
    {
      "value": 0.00885160,
      "n": 1,
      "scriptPubKey": {
        "asm": "OP_HASH160 66c1fb14bc0f482ed900e7a07bdb78763e00adae OP_EQUAL",
        "hex": "a91466c1fb14bc0f482ed900e7a07bdb78763e00adae87",
        "reqSigs": 1,
        "type": "scripthash",
        "addresses": [
          "2N2cZHsXJE8Tj167NmHn4c2aRupGQcsFN2V"
        ]
      }
    }
  ]
}
wen@ubuntu:~/lightning/daemon/test$ $CLI getrawtransaction 63fbd3d081aa3983cdf74a83d2e4307339b20add8e7b0b551b0d685310028bc2 1
{
  "hex": "0200000000010153faf3ab4e5fb31c680be76ef6dd9d2454c3dfbb987280fcc9de6010c48e8f6f00000000171600148e26c73692f1cccbc6678023efccd0ee849ae934ffffffff0188220f0000000000220020c7820cab47f3c7e054a212e997ab18661557adca443226959f6fef8fd776057102483045022100bf290274699e5bb7b098bda97fd35e15768ea79874bd6a76a22c7bcb1a258f9702203dbf5897126e49a3494ced3b2487724c558cada0eb69ecd8b874c238060397d8012103673d1d648371a33432329858856c64909e97fe641ee200deaea3e4a6e5c8533b00000000",
  "txid": "63fbd3d081aa3983cdf74a83d2e4307339b20add8e7b0b551b0d685310028bc2",
  "hash": "968397e1aa06b5f4aee7771e68b7f9cb65a486bd284b72874b2f0422b729cb5d",
  "size": 227,
  "vsize": 145,
  "version": 2,
  "locktime": 0,
  "vin": [
    {
      "txid": "6f8f8ec41060dec9fc807298bbdfc354249dddf66ee70b681cb35f4eabf3fa53",
      "vout": 0,
      "scriptSig": {
        "asm": "00148e26c73692f1cccbc6678023efccd0ee849ae934",
        "hex": "1600148e26c73692f1cccbc6678023efccd0ee849ae934"
      },
      "txinwitness": [
        "3045022100bf290274699e5bb7b098bda97fd35e15768ea79874bd6a76a22c7bcb1a258f9702203dbf5897126e49a3494ced3b2487724c558cada0eb69ecd8b874c238060397d801", 
        "03673d1d648371a33432329858856c64909e97fe641ee200deaea3e4a6e5c8533b"
      ],
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.00991880,
      "n": 0,
      "scriptPubKey": {
        "asm": "0 c7820cab47f3c7e054a212e997ab18661557adca443226959f6fef8fd7760571",
        "hex": "0020c7820cab47f3c7e054a212e997ab18661557adca443226959f6fef8fd7760571",
        "type": "witness_v0_scripthash"
      }
    }
  ],
  "blockhash": "741e8bfcf97a1fcac32313414ecf5f1831f17e094e1cd687e47b23009db49b35",
  "confirmations": 1,
  "time": 1481856207,
  "blocktime": 1481856207
}
wen@ubuntu:~/lightning/daemon/test$ $CLI getrawtransaction 6f8f8ec41060dec9fc807298bbdfc354249dddf66ee70b681cb35f4eabf3fa53 1
{
  "hex": "0100000001bf815ad833c952a9874a8e00e9ea49ff0ed3ce037589cf242360d059a908527c000000006b483045022100f160ef01b023a6f742bf3abaffc54ca952cecaefc8723345e421b87c9d26e193022038669e723aa42bda973ab28a0c4bee303af7c262e5754130524661c19ff1e3a90121029ce5783d44873811bd920bc60738a7b0cf8192a277ce7a117232ccb7d42f0685feffffff0240420f000000000017a9141bd46b67413fce29ddbbeedbf188498f78551d71879488254a000000001976a914e5a0179ecf9bdfceb4f066662716b57004221ed288ace2010000",
  "txid": "6f8f8ec41060dec9fc807298bbdfc354249dddf66ee70b681cb35f4eabf3fa53",
  "hash": "6f8f8ec41060dec9fc807298bbdfc354249dddf66ee70b681cb35f4eabf3fa53",
  "size": 224,
  "vsize": 224,
  "version": 1,
  "locktime": 482,
  "vin": [
    {
      "txid": "7c5208a959d0602324cf897503ced30eff49eae9008e4a87a952c933d85a81bf",
      "vout": 0,
      "scriptSig": {
        "asm": "3045022100f160ef01b023a6f742bf3abaffc54ca952cecaefc8723345e421b87c9d26e193022038669e723aa42bda973ab28a0c4bee303af7c262e5754130524661c19ff1e3a9[ALL] 029ce5783d44873811bd920bc60738a7b0cf8192a277ce7a117232ccb7d42f0685",
        "hex": "483045022100f160ef01b023a6f742bf3abaffc54ca952cecaefc8723345e421b87c9d26e193022038669e723aa42bda973ab28a0c4bee303af7c262e5754130524661c19ff1e3a90121029ce5783d44873811bd920bc60738a7b0cf8192a277ce7a117232ccb7d42f0685"
      },
      "sequence": 4294967294
    }
  ],
  "vout": [
    {
      "value": 0.01000000,
      "n": 0,
      "scriptPubKey": {
        "asm": "OP_HASH160 1bd46b67413fce29ddbbeedbf188498f78551d71 OP_EQUAL",
        "hex": "a9141bd46b67413fce29ddbbeedbf188498f78551d7187",
        "reqSigs": 1,
        "type": "scripthash",
        "addresses": [
          "2MunNhdcVXiLwCPeejmif9nTnHd5cbHd4NN"
        ]
      }
    }, 
    {
      "value": 12.43973780,
      "n": 1,
      "scriptPubKey": {
        "asm": "OP_DUP OP_HASH160 e5a0179ecf9bdfceb4f066662716b57004221ed2 OP_EQUALVERIFY OP_CHECKSIG",
        "hex": "76a914e5a0179ecf9bdfceb4f066662716b57004221ed288ac",
        "reqSigs": 1,
        "type": "pubkeyhash",
        "addresses": [
          "n2T6pPWXovY499pq2Xu6hZkzszQSLbiDp3"
        ]
      }
    }
  ],
  "blockhash": "4f206c15380bbcd086b2246d8a80dfb7b126954d1a5ddc120c8101108f100306",
  "confirmations": 2,
  "time": 1481856160,
  "blocktime": 1481856160
}
wen@ubuntu:~/lightning/daemon/test$ $CLI generate 10
[
  "3d545c2b6c4b22426298c8761f8881fd6b1ede1a2b2085e97ae972e9b7ecc34a", 
  "00584e34e1728df495a354115ade7350e594bba9d29f5cec28ea4a740c6a3cd8", 
  "18695cd1392647be068c369579c89fd48b68244d7baf5a0fb4e239bd391d0512", 
  "25382441332a5f5e2ee94a2112b1056345eeb11d909e3a45d4a6f0ee8c771da0", 
  "10d38007f452e44c29a976a05a8cfb22ef1ab49717c1de1f9553a11be3e1ba03", 
  "1e40752b479a6fe76ea8d7272d7185f4906df3d8fb9e425ba54a9373a874a945", 
  "1fbe2260d0a42e874c2e58610f70499a7bb4444144fcb9000c48a2eae6b76213", 
  "2ad23cd5e651b32b805d2352327c1ec3899ee2e1af20b31c5eb8db7ca46d1e24", 
  "008d55d019124ca45f96e95003adfd49b65ff3c6ec139b22da869b2b444f3ab6", 
  "42ca12c2ac464ab06fa60d85ceb52042809863ad965814c62731d1b5458489fa"
]
wen@ubuntu:~/lightning/daemon/test$ check_no_peers lcli1
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 getpeers
{ peers : [ ] } 
wen@ubuntu:~/lightning/daemon/test$ check_no_peers lcli2
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 getpeers
{ peers : [ ] } 
wen@ubuntu:~/lightning/daemon/test$ lcli1 stop
../lightning-cli --lightning-dir=/tmp/lightning.23222.1 stop
"Shutting down"
wen@ubuntu:~/lightning/daemon/test$ lcli2 stop
../lightning-cli --lightning-dir=/tmp/lightning.23222.2 stop
"Shutting down"
